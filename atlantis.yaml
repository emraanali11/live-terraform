version: 3
projects:
- name: ec2
  dir: services/ec2
  workflow: terragrunt-ec2
- name: iam
  dir: services/iam
  workflow: terragrunt-iam
  autoplan:
    enabled: false
workflows:
 terragrunt:
   plan:
     steps:
     - env:
         name: TERRAGRUNT_TFPATH
         command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
     - run: terragrunt init -input=false -no-color
     - run: terragrunt plan -no-color -out=$PLANFILE
   apply:
     steps:
     - env:
         name: TERRAGRUNT_TFPATH
         command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
     - run: terragrunt apply -no-color $PLANFILE
