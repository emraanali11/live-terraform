version: 3
projects:
- name: pdx-d-ana-eks1
  dir: infrastructure/provisioning/services/
  workflow: terragrunt
  autoplan:
    enabled: false
workflows:
 terragrunt:
   plan:
     steps:
     - env:
         name: TERRAGRUNT_TFPATH
         command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
     extra_args: ["-var-file", "provisioning/env/$PROJECT_NAME.yaml"]
     - run: terragrunt init -input=false -no-color
     - run: terragrunt plan -no-color -out=$PLANFILE
   apply:
     steps:
     extra_args: ["-var-file", "provisioning/env/$PROJECT_NAME.yaml"]
     - env:
         name: TERRAGRUNT_TFPATH
         command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
     - run: terragrunt apply -no-color $PLANFILE
