version: 3
projects:
- name: default
  dir: .
  autoplan:
    enabled: false
- name: ec2
  dir: ../env/ec2/dev
  workflow: terragrunt
- name: ec2
  dir: ../env/ec2/prod
  workflow: terragrunt
- name: ec2
  dir: ../env/ec2/stg
  workflow: terragrunt
workflows:
 terragrunt:
   plan:
     steps:
     - run: rm -rf .terraform
     - env:
         name: TERRAGRUNT_TFPATH
         command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
     - run: terragrunt init -input=false -no-color
     - run: terragrunt plan -no-color -out=$PLANFILE
   apply:
     steps:
     - run: rm -rf .terraform
     - env:
         name: TERRAGRUNT_TFPATH
         command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
     - run: terragrunt apply -no-color $PLANFILE
