version: 3
projects:
- name: ec2
  dir: ec2
  workflow: terragrunt
  autoplan:
    enabled: false
workflows:
 terragrunt:
   plan:
     steps:
     - run: rm -rf .terraform
     - env:
         name: TERRAGRUNT_TFPATH
         command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
     - run: terragrunt init -input=false -no-color 
     - run: terragrunt plan -no-color -out=$PLANFILE
   apply:
     steps:
     - run: rm -rf .terraform
     - env:
         name: TERRAGRUNT_TFPATH
         command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
     - run: terragrunt apply -no-color $PLANFILE
